<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Example</title>
    <script type="text/javascript">
        var exampleSocket = new WebSocket("ws://localhost:8765/");
        var server = "ExampleServer";
        var channel = "ExampleChannel";

        exampleSocket.onopen = function (event) {
            exampleSocket.send(JSON.stringify({
                type: "SubChannel",
                server: server,
                channel: channel
            })); 
        };
    </script>
</head>
<body>
    <input
        id="msg"
        type="text"
    />
    <button id="send">Send Message</button>
    <button id="leave">Stop Messages</button>
    <ul id="messages"></ul>
    <script type="text/javascript">
        var messageInput = document.getElementById("msg");
        var messages = document.getElementById("messages");

        function putNewMessage(message) {
            var li = document.createElement("li");
            var text = document.createTextNode(message);
            li.appendChild(text);
            messages.appendChild(li);
        }

        document.getElementById("send").addEventListener("click", function(event) {
            exampleSocket.send(JSON.stringify({
                type: "NewMessage",
                server: server,
                channel: channel,
                message: messageInput.value
            }));
            putNewMessage(messageInput.value)
            messageInput.value = "";
        });

        document.getElementById("leave").addEventListener("click", function(event) {
            exampleSocket.send(JSON.stringify({
                type: "LeaveChannel",
                server: server,
                channel: channel
            }));
        });
    
        exampleSocket.onmessage = function(event) {
            var response = JSON.parse(event.data);

            if(response.payload && response.payload.message) {
                putNewMessage(response.payload.message);
            }
        };
    </script>
</body>
</html>